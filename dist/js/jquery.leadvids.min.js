/*! 
 * leadvids v1.0.0
 * https://github.com/derekcavaliero/leadvids
 * 
 * Copyright (c) 2018 Derek Cavaliero @ WebMechanix
 * 
 * Date: 2018-10-27 21:52:46 EDT 
 */
!function(a,b,c,d){function e(b,c){this.element=a(b),this.options=a.extend(!0,{},g,a.fn[f].defaults,c),this.element.data("leadvid-form-id")&&(this.options.formId=this.element.data("leadvid-form-id")),this.element.data("leadvid-threshold")&&(this.options.threshold=parseInt(this.element.data("leadvid-threshold"))),this.element.data("leadvid-threshold-unit")&&(this.options.thresholdUnit=this.element.data("leadvid-threshold-unit")),this.element.data("leadvid-freepass")!==!1&&this.element.data("leadvid-freepass")!==!0||(this.options.freepass=this.element.data("leadvid-freepass")),this._defaults=g,this._name=f,this.init()}var f="leadvids",g={provider:{type:"",id:"",host:""},formId:"",freepass:!1,freepassButtonClass:"",freepassLimit:3,freepassText:"Skip this time",overlayHeader:"Want to continue watching?",overlayText:"",submitButtonClass:"",thankYouText:"Thank you! Enjoy the video!",threshold:25,thresholdUnit:"%"};e.prototype={init:function(){this._video=this.parseVideo(),this._iframeId=[this._video.type,this._video.id,this.options.formId].join("-"),this.decorateIframe(),this.loadForm(),this._video.type&&this.loadPlayerApi()},parseVideo:function(){var b=a("<a>",{href:this.element.attr("src")})[0],c=b.href,d=!1,e=!1,f={};if(b.host.indexOf("vimeo")>-1?(d=b.pathname.replace("/video/",""),e="vimeo",f={byline:0,title:0,portrait:0}):b.host.indexOf("youtube")>-1&&(d=b.pathname.replace("/embed/",""),e="youtube",f={enablejsapi:1,disablekb:1,modestbranding:1}),!a.isEmptyObject(f)){for(var g in f)f.hasOwnProperty(g)&&b.search&&b.search.indexOf(g+"="+f[g])>-1&&delete f[g];a.isEmptyObject(f)&&b.search||(f=a.param(f),c+=b.search?"&"+f:"?"+f)}return{id:d,type:e,src:c!==b.href&&c}},decorateIframe:function(){var b=this;this.element.attr("id",this._iframeId),this._video.src&&this.element.attr("src",this._video.src);var c=this.options.freepass&&this.getRemainingFreepasses()>0?'<div class="leadvid__freepass"><button class="leadvid__button '+this.options.freepassButtonClass+'" type="button">'+this.options.freepassText+" <small>("+this.getRemainingFreepasses()+" remaining)</small></button></div>":"";a('<aside class="leadvid__overlay" role="dialog" tabindex="-1" aria-labeledby="leadvid__label--'+this._iframeId+'"><div class="leadvid__content" role="document"><div class="leadvid__header" id="leadvid__label--'+this._iframeId+'">'+this.options.overlayHeader+"</div>"+this.options.overlayText+'</div><div class="leadvid__form" id="leadvid__form--'+this._iframeId+'"></div>'+c+"</aside>").insertAfter(this.element),this._overlay=this.element.siblings(".leadvid__overlay").on("click","button.leadvid__button",function(a){b.removeOverlay(!0)})},loadForm:function(){var b=this,c="#leadvid__form--"+b._iframeId;switch(this.options.provider.type){case"hubspot":hbspt.forms.create({portalId:b.options.provider.id,formId:b.options.formId,target:c,formInstanceId:b._iframeId,groupErrors:!1,css:"",cssRequired:"",submitButtonClass:b.options.submitButtonClass,inlineMsg:"The video will resume in a moment.",onFormReady:function(a){a.find(".hubspot-link__container").remove()},onFormSubmit:function(c){a("#leadvid__form--"+b._iframeId).find(".submitted-message").remove(),b.removeOverlay()}});break;case"marketo":a(c).append('<form id="mktoForm_'+b._iframeId+'"></form>'),MktoForms2.loadForm(b.options.provider.host,b.options.provider.id,b.options.formId,function(c){c.render(a("#mktoForm_"+b._iframeId)),c.onSuccess(function(a,d){return c.getFormElem().hide(),b.removeOverlay(),!1})})}},loadPlayerApi:function(){var c=this,d=!1,e=!1;switch(this._video.type){case"vimeo":b.Vimeo?c.setupPlayerAPI():(d="//player.vimeo.com/api/player.js",e=!0);break;case"youtube":b.YT||(d="//www.youtube.com/iframe_api"),b.onYouTubeIframeAPIReady=function(){c.setupPlayerAPI()}}d&&a.getScript(d,function(a,b,d){e&&c.setupPlayerAPI()})},setupPlayerAPI:function(){var a=this,b=!1;if(!a.checkStorage())switch(this._video.type){case"vimeo":this.Player=new Vimeo.Player(this.element),this.Player.on("timeupdate",function(c,d){if(!a.checkStorage()){var e=100*c.percent;"%"==a.options.thresholdUnit&&e>=a.options.threshold&&(b=!0),"s"==a.options.thresholdUnit&&c.seconds>=a.options.threshold&&(b=!0),b&&this.pause().then(function(){a.showOverlay()})}});break;case"youtube":this.Player=new YT.Player(a._iframeId,{events:{onStateChange:function(a){}}})}},getStorage:function(){return!!localStorage.getItem("leadvids")&&JSON.parse(localStorage.getItem("leadvids"))},checkStorage:function(){var a=this.getStorage();return!(!a||!a[this._video.type])&&a[this._video.type].indexOf(this._video.id)>-1},updateStorage:function(a){var a="undefined"!=typeof a&&a,b=this.getStorage()||{};b[this._video.type]?b[this._video.type].indexOf(this._video.id)===-1&&b[this._video.type].push(this._video.id):b[this._video.type]=[this._video.id],a&&(b.freepass?b.freepass.indexOf(this._video.id)===-1&&b.freepass.push(this._video.id):b.freepass=[this._video.id]),localStorage.setItem("leadvids",JSON.stringify(b))},getRemainingFreepasses:function(){var a=this.getStorage(),b=this.options.freepassLimit;return a&&a.freepass&&(b+=-a.freepass.length),b},showOverlay:function(){this._overlay.hasClass("active")||(this.exitFullscreen(),this._overlay.addClass("active"))},exitFullscreen:function(){c.exitFullscreen?c.exitFullscreen():c.mozCancelFullScreen?c.mozCancelFullScreen():c.webkitExitFullscreen&&c.webkitExitFullscreen()},removeOverlay:function(a){var a="undefined"!=typeof a&&a,b=this;b.updateStorage(a),b._overlay.find(".leadvid__form").hide(),b._overlay.find(".leadvid__freepass").remove(),b._overlay.addClass("success").find(".leadvid__header").html(b.options.thankYouText),setTimeout(function(){b._overlay.removeClass("active"),"vimeo"==b._video.type&&b.Player.play()},1500)}},a.fn[f]=function(c){if(a(b).innerWidth()>=768)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,c))})}}(jQuery,window,document);